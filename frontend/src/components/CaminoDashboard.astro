<section 
  class="mx-auto max-w-6xl px-4 py-10" 
  x-data="caminoDashboard()" 
  x-init="init()" 
>
  <div class="mb-8 flex items-start justify-between gap-6">
    <div>
      <div class="flex items-center gap-3">
        <div class="i-ph-footprints-duotone text-3xl"></div>
        <h1 class="text-2xl font-700 tracking-tight">Camino Dashboard</h1>
      </div>
      <div class="mt-2 text-stone-600" x-text="currentLocation + ' Â· ' + coordinates"></div>
    </div>

    <div class="rounded-2xl bg-white shadow-sm ring-1 ring-stone-200 p-4">
      <div class="text-sm text-stone-500 mb-2">Doodled shell</div>
      <svg id="shellSvg" width="180" height="140" viewBox="0 0 180 140"></svg>
    </div>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
    <div class="rounded-2xl bg-white shadow-sm ring-1 ring-stone-200 p-5 flex items-center gap-4">
      <div class="text-3xl">ğŸ¥¾</div>
      <div>
        <div class="text-2xl font-800" x-text="stats.completedDistance"></div>
        <div class="text-sm text-stone-500">km recorridos</div>
      </div>
    </div>

    <div class="rounded-2xl bg-white shadow-sm ring-1 ring-stone-200 p-5 flex items-center gap-4">
      <div class="text-3xl">ğŸ“…</div>
      <div>
        <div class="text-2xl font-800" x-text="stats.completedDays"></div>
        <div class="text-sm text-stone-500">dÃ­as en camino</div>
      </div>
    </div>

    <div class="rounded-2xl bg-white shadow-sm ring-1 ring-stone-200 p-5 flex items-center gap-4">
      <div class="text-3xl">ğŸ†</div>
      <div>
        <div class="text-2xl font-800"><span x-text="progressPct"></span>%</div>
        <div class="text-sm text-stone-500">completado</div>
      </div>
    </div>
  </div>

  <div class="mt-8 grid grid-cols-1 lg:grid-cols-2 gap-6">
    <div class="rounded-2xl bg-white shadow-sm ring-1 ring-stone-200 p-6">
      <div class="flex items-center justify-between">
        <h2 class="text-lg font-700">ğŸ“Š Progreso General</h2>
        <div class="text-sm text-stone-600"><span x-text="progressPct"></span>%</div>
      </div>

      <div class="mt-4">
        <div class="h-3 rounded-full bg-stone-100 overflow-hidden">
          <div id="overallBar" class="h-full w-0 rounded-full bg-stone-900"></div>
        </div>

        <div class="mt-4 grid grid-cols-3 gap-3 text-center">
          <div class="rounded-xl bg-stone-50 p-3 ring-1 ring-stone-200">
            <div class="text-xl font-800" x-text="stats.completedDistance"></div>
            <div class="text-xs text-stone-500">km completados</div>
          </div>
          <div class="rounded-xl bg-stone-50 p-3 ring-1 ring-stone-200">
            <div class="text-xl font-800" x-text="stats.remainingDistance"></div>
            <div class="text-xs text-stone-500">km restantes</div>
          </div>
          <div class="rounded-xl bg-stone-50 p-3 ring-1 ring-stone-200">
            <div class="text-xl font-800" x-text="stats.totalDistance"></div>
            <div class="text-xs text-stone-500">km total</div>
          </div>
        </div>
      </div>
    </div>

    <div class="rounded-2xl bg-white shadow-sm ring-1 ring-stone-200 p-6">
      <div class="flex items-center justify-between">
        <h2 class="text-lg font-700">ğŸ¯ Etapa Actual</h2>
        <div class="text-sm text-stone-600">38.2 km</div>
      </div>

      <div class="mt-4">
        <div class="flex items-center justify-between text-sm text-stone-600">
          <span>Progreso de Etapa</span>
          <span><span x-text="currentStageProgress"></span>%</span>
        </div>

        <div class="mt-2 h-3 rounded-full bg-stone-100 overflow-hidden">
          <div id="stageBar" class="h-full w-0 rounded-full bg-stone-900"></div>
        </div>

        <div class="mt-3 flex justify-between text-sm text-stone-600">
          <span x-text="Math.round(38.2 * currentStageProgress / 100) + ' km completados'"></span>
          <span x-text="Math.round(38.2 * (100 - currentStageProgress) / 100) + ' km restantes'"></span>
        </div>

        <div class="mt-4 flex gap-2">
          <button class="rounded-xl px-3 py-2 ring-1 ring-stone-300 hover:bg-stone-50" 
            @click="updateStageProgress(-5)"
          >-5%</button>
          <button class="rounded-xl px-3 py-2 ring-1 ring-stone-300 hover:bg-stone-50" 
            @click="updateStageProgress(5)"
          >+5%</button>
        </div>
      </div>
    </div>
  </div>

  <div class="mt-6 grid grid-cols-1 lg:grid-cols-2 gap-6">
    <div class="rounded-2xl bg-white shadow-sm ring-1 ring-stone-200 p-6">
      <h2 class="text-lg font-700">ğŸ“… PlanificaciÃ³n Diaria</h2>

      <div class="mt-4 flex items-center justify-between">
        <div class="text-sm text-stone-600">Objetivo diario</div>
        <div class="flex items-center gap-2">
          <button class="rounded-xl px-3 py-2 ring-1 ring-stone-300 hover:bg-stone-50" 
            @click="updateDailyGoal(-1)"
          >-</button>
          <div class="min-w-22 text-center rounded-xl bg-stone-50 px-3 py-2 ring-1 ring-stone-200 font-700 planning-value">
            <span x-text="dailyGoal"></span> km
          </div>
          <button class="rounded-xl px-3 py-2 ring-1 ring-stone-300 hover:bg-stone-50" 
            @click="updateDailyGoal(1)"
          >+</button>
        </div>
      </div>

      <div class="mt-4 grid gap-2 text-sm text-stone-700">
        <div class="flex items-center gap-2">
          <span>ğŸƒ</span>
          <span x-text="'Promedio actual: ' + stats.averageDailyDistance + ' km/dÃ­a'"></span>
        </div>
        <div class="flex items-center gap-2">
          <span>â±ï¸</span>
          <span x-text="'Estimado restante: ' + Math.ceil(stats.remainingDistance / dailyGoal) + ' dÃ­as'"></span>
        </div>
      </div>
    </div>

    <div class="rounded-2xl bg-white shadow-sm ring-1 ring-stone-200 p-6">
      <h2 class="text-lg font-700">ğŸ’¡ Recomendaciones</h2>

      <div class="mt-4 rounded-2xl bg-stone-50 ring-1 ring-stone-200 p-5">
        <div class="flex items-center gap-3">
          <div class="text-2xl" x-text="recommendation.icon"></div>
          <div class="text-base font-800" x-text="recommendation.title"></div>
        </div>
        <div class="mt-2 text-stone-700" x-text="recommendation.message"></div>
        <div class="mt-3 flex gap-3 text-xs text-stone-600">
          <span class="rounded-full bg-white px-3 py-1 ring-1 ring-stone-200" x-text="'Ritmo: ' + stats.averageDailyDistance + ' km/dÃ­a'"></span>
          <span class="rounded-full bg-white px-3 py-1 ring-1 ring-stone-200" x-text="'DÃ­as: ' + stats.completedDays"></span>
        </div>
      </div>
    </div>
  </div>

  <div class="mt-6 rounded-2xl bg-white shadow-sm ring-1 ring-stone-200 p-6">
    <h2 class="text-lg font-700">ğŸ‰ Datos Curiosos</h2>

    <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-4">
      <template x-for="fact in funFacts" :key="fact.title">
        <div class="rounded-2xl bg-stone-50 ring-1 ring-stone-200 p-5">
          <div class="flex items-center gap-3">
            <div class="text-2xl" x-text="fact.icon"></div>
            <div class="font-800" x-text="fact.title"></div>
          </div>
          <div class="mt-2 text-sm text-stone-700" x-text="fact.description"></div>
          <div class="mt-3 text-xs text-stone-600" x-text="fact.calculation"></div>
        </div>
      </template>
    </div>
  </div>

  <div class="mt-6 rounded-2xl bg-white shadow-sm ring-1 ring-stone-200 p-6">
    <h2 class="text-lg font-700">ğŸ—ºï¸ PrÃ³ximas Etapas</h2>

    <div class="mt-4 grid gap-3">
      <template x-for="stage in pendingStages" :key="stage.id">
        <div class="flex items-center justify-between gap-4 rounded-2xl bg-stone-50 ring-1 ring-stone-200 p-4">
          <div>
            <div class="font-800" x-text="stage.name"></div>
            <div class="mt-1 inline-flex items-center rounded-full px-3 py-1 text-xs ring-1" 
              :class="difficultyPill(stage.difficulty)"
              x-text="stage.difficulty"
            ></div>
          </div>
          <div class="text-right text-sm text-stone-700">
            <div class="font-700" x-text="stage.distance + ' km'"></div>
            <div class="text-stone-600" x-text="stage.estimatedDays + (stage.estimatedDays > 1 ? ' dÃ­as' : ' dÃ­a')"></div>
          </div>
        </div>
      </template>
    </div>
  </div>

  <script type="module">
    import anime from "animejs";
import rough from "roughjs/bundled/rough.esm.js";

    window.caminoDashboard = () => {
      const state = {
        stats: {
          totalDistance: 847,
          completedDistance: 127,
          remainingDistance: 720,
          totalDays: 34,
          completedDays: 7,
          averageDailyDistance: 18.1,
          totalSteps: 168420,
          totalCalories: 18932,
          totalElevation: 1247,
          achievements: 2,
        },
        stages: [
          { id: "1", name: "Sevilla â†’ Guillena", distance: 22.2, completed: true, difficulty: "easy", estimatedDays: 1, actualDays: 1, startDate: "2024-01-08", endDate: "2024-01-08" },
          { id: "2", name: "Guillena â†’ Castilblanco", distance: 18.5, completed: true, difficulty: "easy", estimatedDays: 1, actualDays: 1, startDate: "2024-01-09", endDate: "2024-01-09" },
          { id: "3", name: "Castilblanco â†’ AlmadÃ©n", distance: 25.8, completed: true, difficulty: "medium", estimatedDays: 1, actualDays: 1, startDate: "2024-01-10", endDate: "2024-01-10" },
          { id: "4", name: "AlmadÃ©n â†’ Real de la Jara", distance: 19.3, completed: true, difficulty: "easy", estimatedDays: 1, actualDays: 1, startDate: "2024-01-11", endDate: "2024-01-11" },
          { id: "5", name: "Real de la Jara â†’ Monesterio", distance: 21.7, completed: true, difficulty: "medium", estimatedDays: 1, actualDays: 1, startDate: "2024-01-12", endDate: "2024-01-12" },
          { id: "6", name: "Monesterio â†’ Fuente de Cantos", distance: 19.4, completed: true, difficulty: "easy", estimatedDays: 1, actualDays: 1, startDate: "2024-01-13", endDate: "2024-01-13" },
          { id: "7", name: "Fuente de Cantos â†’ Zafra", distance: 20.1, completed: true, difficulty: "easy", estimatedDays: 1, actualDays: 1, startDate: "2024-01-14", endDate: "2024-01-14" },
          { id: "8", name: "Zafra â†’ Villafranca", distance: 19.8, completed: false, difficulty: "medium", estimatedDays: 1 },
          { id: "9", name: "Villafranca â†’ AlcuÃ©scar", distance: 38.2, completed: false, difficulty: "hard", estimatedDays: 2 },
          { id: "10", name: "AlcuÃ©scar â†’ CÃ¡ceres", distance: 23.1, completed: false, difficulty: "medium", estimatedDays: 1 },
        ],
        funFacts: [
          {
            icon: "ğŸŒ",
            title: "Has caminado el equivalente a...",
            description: "Â¡Cruzar la penÃ­nsula ibÃ©rica de este a oeste! Tu distancia recorrida es similar a la anchura de EspaÃ±a en su punto mÃ¡s estrecho.",
            calculation: "127 km â‰ˆ Ancho de EspaÃ±a (mÃ­nimo)",
          },
          {
            icon: "ğŸ”¥",
            title: "CalorÃ­as quemadas",
            description: "Las 18,932 calorÃ­as equivalen a 37 bocadillos de tortilla espaÃ±ola o 75 cafÃ©s con leche. Â¡Eso es mucha energÃ­a!",
            calculation: "18,932 cal Ã· 510 cal/bocadillo = 37 bocadillos",
          },
          {
            icon: "ğŸ‘£",
            title: "Pasos dados",
            description: "Tus 168,420 pasos equivalen a subir y bajar la Torre Eiffel aproximadamente 28 veces. Â¡QuÃ© altura!",
            calculation: "168,420 pasos Ã· 6,000 pasos/ascenso = 28 ascensos",
          },
          {
            icon: "â°",
            title: "Tiempo de calidad",
            description: "Has pasado 29.4 horas caminando, lo que equivale a ver 14 pelÃ­culas largas o leer 147 pÃ¡ginas de un buen libro.",
            calculation: "29.4 hrs Ã· 2.1 hrs/pelÃ­cula = 14 pelÃ­culas",
          },
        ],
        currentStageProgress: 68,
        dailyGoal: 25,
        currentLocation: "MÃ©rida, EspaÃ±a",
        coordinates: "38.9141Â° N, 6.3370Â° W",

        get progressPct() {
          const completed = state.stages.filter((s) => s.completed).length;
          const total = state.stages.length;
          return Math.round((completed / total) * 100);
        },

        get pendingStages() {
          return state.stages.filter((s) => !s.completed);
        },

        get recommendation() {
          const avg = state.stats.averageDailyDistance;
          if (avg > 22) return { type: "warning", title: "Â¡Cuidado!", message: "Tu ritmo es excelente pero exigente. Considera tomarte un dÃ­a de descanso pronto.", icon: "âš ï¸" };
          if (avg < 15) return { type: "info", title: "Consejo", message: "PodrÃ­as aumentar un poco tu ritmo diario para optimizar tu viaje.", icon: "ğŸ’¡" };
          return { type: "success", title: "Â¡Perfecto!", message: "Tu ritmo es ideal para disfrutar el Camino sin agotarte.", icon: "âœ…" };
        },

        difficultyPill(d) {
          if (d === "easy") return "text-green-700 bg-green-50 ring-green-200";
          if (d === "medium") return "text-yellow-800 bg-yellow-50 ring-yellow-200";
          if (d === "hard") return "text-red-700 bg-red-50 ring-red-200";
          return "text-stone-700 bg-stone-50 ring-stone-200";
        },

        updateDailyGoal(delta) {
          state.dailyGoal = Math.max(15, Math.min(35, state.dailyGoal + delta));
          anime({ targets: ".planning-value", scale: [1, 1.03, 1], duration: 350, easing: "easeOutQuad" });
        },

        updateStageProgress(delta) {
          state.currentStageProgress = Math.max(0, Math.min(100, state.currentStageProgress + delta));
          state.animateBars();
        },

        animateBars() {
          anime({
            targets: "#overallBar",
            width: `${state.progressPct}%`,
            duration: 650,
            easing: "easeOutCubic",
          });
          anime({
            targets: "#stageBar",
            width: `${state.currentStageProgress}%`,
            duration: 650,
            easing: "easeOutCubic",
          });
        },

        drawShell() {
          const svg = document.getElementById("shellSvg");
          if (!svg) return;

          while (svg.firstChild) svg.removeChild(svg.firstChild);

          const rc = rough.svg(svg);
          const ink = { stroke: "#111", strokeWidth: 2.2, roughness: 2.2, bowing: 1.4, fillStyle: "hachure", hachureGap: 3.2, hachureAngle: -35 };

          const base = rc.path(
            "M18 108 C24 80, 44 52, 78 34 C99 23, 120 20, 138 26 C156 32, 168 46, 167 63 C166 79, 155 93, 141 101 C120 113, 96 118, 70 118 C46 118, 26 115, 18 108 Z",
            { ...ink, fill: "transparent" }
          );

          const lip = rc.path(
            "M30 110 C33 92, 48 66, 80 48 C99 38, 120 35, 134 40 C148 45, 157 56, 156 68 C155 79, 146 90, 134 96 C116 105, 96 110, 70 111 C52 112, 38 112, 30 110 Z",
            { stroke: "#111", strokeWidth: 1.6, roughness: 2.4 }
          );

          const ridgePaths = [
            "M80 44 C76 64, 72 84, 70 112",
            "M92 41 C90 63, 88 84, 86 112",
            "M104 42 C104 63, 104 84, 102 110",
            "M66 51 C62 72, 58 92, 58 114",
            "M118 49 C124 68, 128 86, 132 104",
            "M52 62 C46 79, 42 96, 42 111",
            "M132 62 C144 76, 154 88, 158 100",
          ].map((d) => rc.path(d, { stroke: "#111", strokeWidth: 1.2, roughness: 2.8, bowing: 1.6 }));

          const cross = rc.path(
            "M102 38 L102 96 M88 54 L116 54 M92 54 C90 60, 88 62, 82 64 M112 54 C114 60, 116 62, 122 64",
            { stroke: "#111", strokeWidth: 2.1, roughness: 1.8, bowing: 0.9 }
          );

          svg.appendChild(base);
          svg.appendChild(lip);
          ridgePaths.forEach((p) => svg.appendChild(p));
          svg.appendChild(cross);

          anime({
            targets: "#shellSvg",
            opacity: [0, 1],
            translateY: [-4, 0],
            duration: 700,
            easing: "easeOutCubic",
          });
        },

        init() {
          state.animateBars();
          state.drawShell();
        },
      };

      return state;
    };
  </script>
</section>
